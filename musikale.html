<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Jingle Engra√ßado</title>
    <style>
        :root { --roxo: #8B5CF6; --rosa: #EC4899; --amarelo: #FBBF24; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
        body { background: linear-gradient(135deg, #F3E8FF 0%, #FFE4E6 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { max-width: 600px; width: 100%; }
        .card { background: white; border-radius: 24px; padding: 40px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        /* Cabe√ßalho */
        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 3rem; margin-bottom: 10px; }
        h1 { color: var(--roxo); font-size: 2.2rem; margin-bottom: 10px; }
        .subtitle { color: #6B7280; font-size: 1.1rem; }
        
        /* Quiz */
        .progress { height: 6px; background: #E5E7EB; border-radius: 3px; margin: 30px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--roxo), var(--rosa)); width: 0%; transition: width 0.4s; }
        .question-box { margin-bottom: 30px; }
        .question-num { color: var(--roxo); font-weight: 600; margin-bottom: 8px; }
        .question-text { font-size: 1.4rem; color: #1F2937; margin-bottom: 25px; line-height: 1.4; }
        
        /* Op√ß√µes */
        .options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 30px; }
        .option { padding: 18px 20px; border: 2px solid #E5E7EB; border-radius: 16px; cursor: pointer; transition: all 0.2s; background: #F9FAFB; }
        .option:hover { border-color: var(--roxo); transform: translateY(-2px); }
        .option.selected { border-color: var(--roxo); background: #F5F3FF; }
        .option-emoji { font-size: 1.5rem; margin-right: 10px; }
        
        /* Bot√µes */
        .btn { background: var(--roxo); color: white; border: none; padding: 16px 32px; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: block; width: 100%; }
        .btn:hover { background: #7C3AED; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3); }
        .btn:disabled { background: #D1D5DB; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: white; color: var(--roxo); border: 2px solid var(--roxo); }
        
        /* Telas */
        .screen { transition: opacity 0.3s; }
        .loading { text-align: center; padding: 40px 0; }
        .spinner { width: 50px; height: 50px; border: 4px solid #E5E7EB; border-top: 4px solid var(--roxo); border-radius: 50%; margin: 0 auto 25px; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Resultado */
        .player { background: #F8FAFC; border-radius: 16px; padding: 25px; margin: 30px 0; }
        audio { width: 100%; border-radius: 10px; }
        .actions { display: flex; gap: 15px; justify-content: center; margin-top: 30px; }
        .action-btn { width: auto; min-width: 180px; text-align: center; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; }
        .action-btn i { margin-right: 8px; }
        
        /* Responsivo */
        @media (max-width: 640px) {
            .card { padding: 25px; }
            h1 { font-size: 1.8rem; }
            .actions { flex-direction: column; }
            .action-btn { width: 100%; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- TELA 1: INTRODU√á√ÉO -->
        <div class="card screen" id="screen-intro">
            <div class="header">
                <div class="logo">üéµ</div>
                <h1>Jingle da Minha Cara</h1>
                <p class="subtitle">Responda 5 perguntinhas e ganhe uma m√∫sica ENGRA√áADA cantada sobre voc√™!</p>
            </div>
            <button class="btn" id="btn-start">Come√ßar Divers√£o ‚ûî</button>
        </div>

        <!-- TELA 2: QUIZ -->
        <div class="card screen hidden" id="screen-quiz">
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="question-box">
                <div class="question-num" id="question-num">Pergunta 1 de 5</div>
                <div class="question-text" id="question-text">Qual animal te representa?</div>
                
                <div class="options" id="options">
                    <!-- Op√ß√µes preenchidas por JavaScript -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" id="btn-prev" style="flex: 1;">‚Üê Voltar</button>
                <button class="btn" id="btn-next" style="flex: 2;" disabled>Pr√≥xima ‚Üí</button>
            </div>
        </div>

        <!-- TELA 3: NOME -->
        <div class="card screen hidden" id="screen-name">
            <div class="header">
                <div class="logo">‚ú®</div>
                <h2>Quase l√°!</h2>
                <p class="subtitle">Como devemos te chamar na m√∫sica?</p>
            </div>
            
            <input type="text" id="input-name" placeholder="Digite seu nome ou apelido..." 
                   style="width: 100%; padding: 18px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1.1rem; margin: 25px 0;">
            
            <button class="btn" id="btn-create">üé§ Criar Minha M√∫sica!</button>
        </div>

        <!-- TELA 4: CARREGANDO -->
        <div class="card screen hidden" id="screen-loading">
            <div class="loading">
                <div class="spinner"></div>
                <h2 style="color: var(--roxo); margin-bottom: 15px;">Criando sua m√∫sica...</h2>
                <p class="subtitle">A IA est√° escrevendo letras engra√ßadas, compondo a melodia e preparando a voz!</p>
                <div style="background: #F0F9FF; padding: 15px; border-radius: 12px; margin-top: 25px; border-left: 4px solid var(--roxo);">
                    <strong>Dica:</strong> A m√∫sica pode levar de 30 segundos a 2 minutos para ficar pronta.
                </div>
            </div>
        </div>

        <!-- TELA 5: RESULTADO -->
        <div class="card screen hidden" id="screen-result">
            <div class="header">
                <div class="logo">üéâ</div>
                <h1>Sua m√∫sica est√° pronta!</h1>
                <p class="subtitle">Uma obra-prima musical sobre voc√™:</p>
            </div>
            
            <h3 id="song-title" style="text-align: center; color: var(--rosa); margin: 20px 0;">Jingle do [Nome]</h3>
            
            <div class="player">
                <audio controls id="audio-player" style="width: 100%;">
                    Seu navegador n√£o suporta o player de √°udio.
                </audio>
            </div>
            
            <div class="actions">
                <a class="btn action-btn" id="btn-download">
                    <i class="fas fa-download"></i> Baixar MP3
                </a>
                <button class="btn btn-secondary action-btn" id="btn-restart">
                    <i class="fas fa-redo"></i> Fazer outra
                </button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO DA API (AGORA DIRETO DO FRONTEND)
        const API_KEY = '85496f40a8f28f52c5cdba0b1c293034'; // Sua chave direto aqui
        const API_URL = 'https://api.sunoapi.org/api/v1/generate';
        
        // Estado da aplica√ß√£o
        const appState = {
            step: 0,
            answers: [],
            userName: '',
            audioUrl: '',
            currentQuestion: 0
        };

        // Perguntas otimizadas para gerar bom prompt
        const questions = [
            {
                text: "Qual animal te representa?",
                emoji: "üêæ",
                options: [
                    { text: "Macaco bagunceiro e divertido", emoji: "üêµ", value: "macaco bagunceiro" },
                    { text: "Le√£o l√≠der e corajoso", emoji: "ü¶Å", value: "le√£o corajoso" },
                    { text: "Golfinho brincalh√£o", emoji: "üê¨", value: "golfinho brincalh√£o" },
                    { text: "Coruja s√°bia e tranquila", emoji: "ü¶â", value: "coruja s√°bia" }
                ]
            },
            {
                text: "Qual sua energia no dia a dia?",
                emoji: "‚ö°",
                options: [
                    { text: "Acelerado, sempre ligado no 220V", emoji: "üöÄ", value: "energia m√°xima acelerada" },
                    { text: "Relax, na minha tranquilidade", emoji: "üòé", value: "calmo e relaxado" },
                    { text: "Altos e baixos, depende do dia", emoji: "üé¢", value: "energia vari√°vel" },
                    { text: "Foco total, nada me distrai", emoji: "üéØ", value: "focado e determinado" }
                ]
            },
            {
                text: "Qual estilo musical combina com voc√™?",
                emoji: "üéµ",
                options: [
                    { text: "Pop animado e contagiante", emoji: "üé§", value: "pop animado" },
                    { text: "Funk dan√ßante e descontra√≠do", emoji: "üï∫", value: "funk dan√ßante" },
                    { text: "Sertanejo emocionado", emoji: "üé∏", value: "sertanejo" },
                    { text: "Rock com atitude", emoji: "ü§ò", value: "rock com atitude" }
                ]
            },
            {
                text: "Qual seu poder secreto?",
                emoji: "ü¶∏",
                options: [
                    { text: "Fazer amigos em qualquer lugar", emoji: "ü§ù", value: "fazer amigos facilmente" },
                    { text: "Encontrar comida sem precisar procurar", emoji: "üçï", value: "encontrar comida" },
                    { text: "Dormir em qualquer situa√ß√£o", emoji: "üò¥", value: "dormir em qualquer lugar" },
                    { text: "Fazer piadas na hora certa", emoji: "üòÇ", value: "fazer piadas engra√ßadas" }
                ]
            },
            {
                text: "Como voc√™ enfrenta desafios?",
                emoji: "üèîÔ∏è",
                options: [
                    { text: "Com coragem, enfrento de frente", emoji: "üí™", value: "com coragem e determina√ß√£o" },
                    { text: "Com criatividade, invento solu√ß√µes", emoji: "üí°", value: "com criatividade" },
                    { text: "Com humor, descontraio a situa√ß√£o", emoji: "üòÑ", value: "com humor e leveza" },
                    { text: "Com calma, penso antes de agir", emoji: "üßò", value: "com calma e planejamento" }
                ]
            }
        ];

        // Elementos DOM
        const screens = ['intro', 'quiz', 'name', 'loading', 'result'].map(id => document.getElementById(`screen-${id}`));
        const progressBar = document.getElementById('progress-bar');
        const questionNum = document.getElementById('question-num');
        const questionText = document.getElementById('question-text');
        const optionsEl = document.getElementById('options');
        const audioPlayer = document.getElementById('audio-player');
        const songTitle = document.getElementById('song-title');
        
        // Bot√µes
        document.getElementById('btn-start').addEventListener('click', () => showScreen('quiz'));
        document.getElementById('btn-prev').addEventListener('click', prevQuestion);
        document.getElementById('btn-next').addEventListener('click', nextQuestion);
        document.getElementById('btn-create').addEventListener('click', createMusic);
        document.getElementById('btn-restart').addEventListener('click', restartApp);
        document.getElementById('input-name').addEventListener('input', function() {
            document.getElementById('btn-create').disabled = !this.value.trim();
        });

        // Inicializar
        function init() {
            updateQuestion();
        }

        // Mostrar tela espec√≠fica
        function showScreen(screenId) {
            screens.forEach(screen => screen.classList.add('hidden'));
            document.getElementById(`screen-${screenId}`).classList.remove('hidden');
            
            if (screenId === 'quiz') updateQuestion();
            if (screenId === 'result' && appState.audioUrl) {
                audioPlayer.src = appState.audioUrl;
                songTitle.textContent = `Jingle do ${appState.userName}`;
                document.getElementById('btn-download').href = appState.audioUrl;
                document.getElementById('btn-download').download = `jingle-${appState.userName.replace(/\s+/g, '-')}.mp3`;
            }
        }

        // Atualizar pergunta atual
        function updateQuestion() {
            const q = questions[appState.currentQuestion];
            const progress = ((appState.currentQuestion + 1) / questions.length) * 100;
            
            progressBar.style.width = `${progress}%`;
            questionNum.textContent = `Pergunta ${appState.currentQuestion + 1} de ${questions.length}`;
            questionText.textContent = q.text;
            
            // Limpar e adicionar op√ß√µes
            optionsEl.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = `option ${appState.answers[appState.currentQuestion] === idx ? 'selected' : ''}`;
                div.innerHTML = `<span class="option-emoji">${opt.emoji}</span>${opt.text}`;
                div.addEventListener('click', () => selectOption(idx));
                optionsEl.appendChild(div);
            });
            
            // Atualizar bot√µes
            document.getElementById('btn-prev').disabled = appState.currentQuestion === 0;
            document.getElementById('btn-next').disabled = appState.answers[appState.currentQuestion] === undefined;
        }

        function selectOption(idx) {
            optionsEl.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            optionsEl.children[idx].classList.add('selected');
            appState.answers[appState.currentQuestion] = idx;
            document.getElementById('btn-next').disabled = false;
        }

        function nextQuestion() {
            if (appState.currentQuestion < questions.length - 1) {
                appState.currentQuestion++;
                updateQuestion();
            } else {
                showScreen('name');
            }
        }

        function prevQuestion() {
            if (appState.currentQuestion > 0) {
                appState.currentQuestion--;
                updateQuestion();
            }
        }

        // FUN√á√ÉO PRINCIPAL: Criar m√∫sica usando API diretamente
        async function createMusic() {
            appState.userName = document.getElementById('input-name').value.trim();
            if (!appState.userName) return alert("Digite seu nome!");
            
            showScreen('loading');
            
            // 1. Construir prompt descritivo (para o modo n√£o-customizado)
            const prompt = buildPrompt();
            console.log("Prompt enviado para a IA do Suno:", prompt);
            
            // 2. Configura√ß√£o SIMPLES para o modo n√£o-customizado
            const requestData = {
                customMode: false,       // MODO N√ÉO-CUSTOMIZADO - Suno gera letra automaticamente!
                prompt: prompt,          // Apenas isso! A IA cria letra e m√∫sica
                model: "V4_5ALL"         // Modelo recomendado
            };
            
            try {
                // 3. Fazer requisi√ß√£o DIRETA para a API (sem backend)
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API respondeu com erro ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const taskId = result.data.taskId;
                    console.log("M√∫sica em produ√ß√£o! Task ID:", taskId);
                    
                    // 4. Verificar status at√© a m√∫sica ficar pronta
                    await waitForMusic(taskId);
                    
                } else {
                    throw new Error(result.msg || "Erro desconhecido da API");
                }
                
            } catch (error) {
                console.error("Erro detalhado:", error);
                
                // Modo de demonstra√ß√£o se a API falhar
                if (error.message.includes('CORS') || error.message.includes('401')) {
                    alert("API bloqueada pelo navegador (problema de CORS). Veja o console para detalhes.");
                    simulateSuccess(); // Modo de demonstra√ß√£o
                } else {
                    alert(`Erro: ${error.message}\n\nVeja o console (F12) para mais detalhes.`);
                    showScreen('name');
                }
            }
        }

        // Construir prompt descritivo para a IA do Suno
        function buildPrompt() {
            const name = appState.userName;
            const traits = appState.answers.map((ansIdx, qIdx) => {
                return questions[qIdx].options[ansIdx].value;
            }).join(', ');
            
            // Prompt para o modo n√£o-customizado (at√© 500 caracteres)
            return `Crie uma m√∫sica ENGRA√áADA e ANIMADA sobre ${name}. 
            ${name} √© uma pessoa ${traits}. 
            A m√∫sica deve ser divertida, exagerada e caricata, com letras criativas que mencionem essas caracter√≠sticas de forma humorada. 
            Estilo musical: pop animado brasileiro com toques de com√©dia. 
            A m√∫sica deve fazer todos rirem e ser super cativante!`;
        }

        // Verificar status da m√∫sica periodicamente
        async function waitForMusic(taskId) {
            const maxAttempts = 30; // 30 tentativas (cerca de 1.5 minuto)
            const checkUrl = `https://api.sunoapi.org/api/v1/generate/${taskId}`;
            
            for (let i = 0; i < maxAttempts; i++) {
                await new Promise(resolve => setTimeout(resolve, 3000)); // Espera 3 segundos
                
                try {
                    const statusRes = await fetch(checkUrl, {
                        headers: { 'Authorization': `Bearer ${API_KEY}` }
                    });
                    
                    if (statusRes.ok) {
                        const statusData = await statusRes.json();
                        console.log("Status da m√∫sica:", statusData);
                        
                        if (statusData.code === 200 && statusData.data && statusData.data.status === 'complete') {
                            // M√∫sica pronta!
                            const audioUrl = statusData.data.audioUrl || statusData.data.streamUrl;
                            if (audioUrl) {
                                appState.audioUrl = audioUrl;
                                showScreen('result');
                                return;
                            }
                        }
                    }
                } catch (err) {
                    console.log("Erro ao verificar status:", err);
                }
            }
            
            // Se chegou aqui, timeout
            alert("A m√∫sica est√° demorando mais que o normal. Tente novamente em alguns instantes!");
            showScreen('name');
        }

        // Modo de demonstra√ß√£o (se a API n√£o funcionar)
        function simulateSuccess() {
            setTimeout(() => {
                appState.audioUrl = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3';
                alert("Modo demonstra√ß√£o: Em produ√ß√£o real, aqui estaria sua m√∫sica gerada pela IA do Suno!");
                showScreen('result');
            }, 2000);
        }

        function restartApp() {
            appState.currentQuestion = 0;
            appState.answers = [];
            appState.userName = '';
            appState.audioUrl = '';
            document.getElementById('input-name').value = '';
            audioPlayer.src = '';
            showScreen('intro');
        }

        // Iniciar
        init();
    </script>
</body>
</html>
